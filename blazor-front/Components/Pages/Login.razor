@page "/login"
@layout EmptyLayout
@using DataForeman.BlazorUI.Services
@inject CustomAuthStateProvider AuthProvider
@inject NavigationManager Navigation

<PageTitle>Login - DataForeman</PageTitle>

<div class="login-page">
    <div class="login-window">
        <!-- Window Title Bar -->
        <div class="window-title">
            <span class="window-icon" aria-hidden="true">&#9881;</span>
            <span>DataForeman - Login</span>
        </div>
        
        <!-- Window Content -->
        <div class="window-content">
            <div class="login-header">
                <span class="app-icon" aria-hidden="true">&#9881;</span>
                <div class="app-info">
                    <strong>DataForeman</strong>
                    <span>Industrial Data Management</span>
                </div>
            </div>
            
            @if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <div class="error-box" role="alert">
                    <span aria-hidden="true">X</span> @ErrorMessage
                </div>
            }
            
            <div class="login-form">
                <div class="form-row">
                    <label for="email">User ID:</label>
                    <input type="email" id="email" @bind="Email" placeholder="admin@dataforeman.local" disabled="@IsLoading" />
                </div>
                
                <div class="form-row">
                    <label for="password">Password:</label>
                    <input type="password" id="password" @bind="Password" disabled="@IsLoading" />
                </div>
                
                <div class="form-buttons">
                    <button class="btn-classic btn-default" @onclick="HandleLogin" disabled="@IsLoading">
                        @(IsLoading ? "Logging in..." : "OK")
                    </button>
                    <button class="btn-classic" @onclick="ClearForm">Clear</button>
                </div>
            </div>
            
            @if (ShowDemoMode)
            {
                <div class="demo-section">
                    <div class="demo-header">Demo Mode Available</div>
                    <p>Use demo account for testing.</p>
                    <button class="btn-classic" @onclick="UseDemoAccount">Demo Login</button>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .login-page {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #008080;
    }
    
    .login-window {
        width: 320px;
        background: #d4d0c8;
        border: 2px solid;
        border-color: #ffffff #808080 #808080 #ffffff;
        box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.3);
    }
    
    .window-title {
        background: linear-gradient(90deg, #000080, #1084d0);
        color: white;
        padding: 2px 4px;
        display: flex;
        align-items: center;
        gap: 4px;
        font-weight: bold;
        font-size: 12px;
    }
    
    .window-icon {
        font-size: 12px;
    }
    
    .window-title span:not(.window-icon) {
        flex: 1;
    }
    
    .window-content {
        padding: 12px;
    }
    
    .login-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #808080;
    }
    
    .app-icon {
        font-size: 32px;
        color: #000080;
    }
    
    .app-info {
        display: flex;
        flex-direction: column;
        font-size: 12px;
    }
    
    .app-info strong {
        font-size: 14px;
        margin-bottom: 2px;
    }
    
    .app-info span {
        color: #404040;
    }
    
    .error-box {
        background: #ffffff;
        border: 1px solid #800000;
        color: #800000;
        padding: 6px 8px;
        margin-bottom: 12px;
        font-size: 12px;
    }
    
    .login-form {
        margin-bottom: 8px;
    }
    
    .form-row {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .form-row label {
        width: 70px;
        font-size: 12px;
        text-align: right;
        padding-right: 8px;
    }
    
    .form-row input {
        flex: 1;
        background: #ffffff;
        border: 2px solid;
        border-color: #808080 #ffffff #ffffff #808080;
        padding: 2px 4px;
        font-size: 12px;
        font-family: inherit;
        height: 22px;
    }
    
    .form-row input:focus {
        outline: 1px dotted #000080;
        outline-offset: -2px;
    }
    
    .form-buttons {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 16px;
    }
    
    .btn-classic {
        background: #d4d0c8;
        border: 2px solid;
        border-color: #ffffff #808080 #808080 #ffffff;
        padding: 2px 16px;
        font-size: 12px;
        min-height: 22px;
        min-width: 75px;
        cursor: pointer;
        font-family: inherit;
    }
    
    .btn-classic:hover {
        background: #e0e0e0;
    }
    
    .btn-classic:active {
        border-color: #808080 #ffffff #ffffff #808080;
    }
    
    .btn-classic:focus {
        outline: 1px dotted #000000;
        outline-offset: -4px;
    }
    
    .btn-classic:disabled {
        color: #808080;
        text-shadow: 1px 1px #ffffff;
    }
    
    .btn-default {
        border: 3px solid;
        border-color: #404040 #404040 #404040 #404040;
        box-shadow: inset 0 0 0 1px #ffffff, inset -1px -1px 0 1px #808080;
    }
    
    .demo-section {
        margin-top: 12px;
        padding: 8px;
        border: 1px solid #808080;
        background: #ffffcc;
        font-size: 12px;
    }
    
    .demo-header {
        font-weight: bold;
        margin-bottom: 4px;
    }
    
    .demo-section p {
        margin: 4px 0 8px;
        color: #404040;
    }
</style>

@code {
    private string Email = "";
    private string Password = "";
    private string ErrorMessage = "";
    private bool IsLoading = false;
    private bool ShowDemoMode = false;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthProvider.GetAuthenticationStateAsync();
        if (authState.User.Identity?.IsAuthenticated == true)
        {
            Navigation.NavigateTo("/");
        }
    }

    private async Task HandleLogin()
    {
        if (string.IsNullOrWhiteSpace(Email) || string.IsNullOrWhiteSpace(Password))
        {
            ErrorMessage = "Please enter your user ID and password.";
            return;
        }

        IsLoading = true;
        ErrorMessage = "";

        try
        {
            var result = await AuthProvider.LoginAsync(Email, Password);

            if (result.Success)
            {
                Navigation.NavigateTo("/");
            }
            else
            {
                ErrorMessage = result.Error ?? "Login failed. Please try again.";
            }
        }
        catch (Exception)
        {
            ErrorMessage = "An error occurred. Please try again.";
        }
        finally
        {
            IsLoading = false;
        }
    }
    
    private void ClearForm()
    {
        Email = "";
        Password = "";
        ErrorMessage = "";
    }

    private void UseDemoAccount()
    {
        Email = "demo@dataforeman.local";
        Password = "demo123";
    }
}
