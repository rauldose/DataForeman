{
  "stateMachines": [
    {
      "id": "sm-sample-1",
      "name": "Pump Controller",
      "description": "Controls the main process pump lifecycle: Idle, Starting, Running, Stopping, with Fault handling. Uses tag-based triggers and actions.",
      "enabled": true,
      "states": [
        {
          "id": "state-idle",
          "name": "Idle",
          "color": "#6b7280",
          "x": 120,
          "y": 200,
          "isInitial": true,
          "isFinal": false,
          "description": "Pump is off and waiting for start command",
          "onEnterActions": [
            { "tagPath": "Simulator/PumpActive", "value": "0" }
          ],
          "onExitActions": []
        },
        {
          "id": "state-starting",
          "name": "Starting",
          "color": "#f59e0b",
          "x": 350,
          "y": 100,
          "isInitial": false,
          "isFinal": false,
          "description": "Pump is warming up",
          "onEnterActions": [
            { "tagPath": "Simulator/PumpActive", "value": "1" }
          ],
          "onExitActions": []
        },
        {
          "id": "state-running",
          "name": "Running",
          "color": "#22c55e",
          "x": 580,
          "y": 200,
          "isInitial": false,
          "isFinal": false,
          "description": "Pump is operational at full speed",
          "onEnterActions": [],
          "onExitActions": []
        },
        {
          "id": "state-stopping",
          "name": "Stopping",
          "color": "#f59e0b",
          "x": 350,
          "y": 320,
          "isInitial": false,
          "isFinal": false,
          "description": "Pump is decelerating",
          "onEnterActions": [],
          "onExitActions": []
        },
        {
          "id": "state-fault",
          "name": "Fault",
          "color": "#ef4444",
          "x": 580,
          "y": 400,
          "isInitial": false,
          "isFinal": true,
          "description": "Pump encountered an error",
          "onEnterActions": [
            { "tagPath": "Simulator/PumpActive", "value": "0" },
            { "tagPath": "Simulator/AlarmActive", "value": "1" }
          ],
          "onExitActions": [
            { "tagPath": "Simulator/AlarmActive", "value": "0" }
          ]
        }
      ],
      "transitions": [
        {
          "id": "t1",
          "fromStateId": "state-idle",
          "toStateId": "state-starting",
          "event": "start",
          "priority": 0,
          "trigger": {
            "tagPath": "Simulator/StartCommand",
            "operator": "Eq",
            "threshold": "1"
          },
          "actions": []
        },
        {
          "id": "t2",
          "fromStateId": "state-starting",
          "toStateId": "state-running",
          "event": "ready",
          "priority": 0,
          "trigger": {
            "tagPath": "Simulator/Speed",
            "operator": "Gte",
            "threshold": "90"
          },
          "actions": []
        },
        {
          "id": "t3",
          "fromStateId": "state-running",
          "toStateId": "state-stopping",
          "event": "stop",
          "priority": 0,
          "trigger": {
            "tagPath": "Simulator/StopCommand",
            "operator": "Eq",
            "threshold": "1"
          },
          "actions": []
        },
        {
          "id": "t4",
          "fromStateId": "state-stopping",
          "toStateId": "state-idle",
          "event": "stopped",
          "priority": 0,
          "trigger": {
            "tagPath": "Simulator/Speed",
            "operator": "Lte",
            "threshold": "5"
          },
          "actions": []
        },
        {
          "id": "t5",
          "fromStateId": "state-running",
          "toStateId": "state-fault",
          "event": "overheat",
          "priority": 1,
          "trigger": {
            "tagPath": "Simulator/Temperature",
            "operator": "Gt",
            "threshold": "95"
          },
          "actions": [
            { "tagPath": "Simulator/PumpActive", "value": "0" }
          ]
        },
        {
          "id": "t6",
          "fromStateId": "state-starting",
          "toStateId": "state-fault",
          "event": "overheat",
          "priority": 1,
          "trigger": {
            "tagPath": "Simulator/Temperature",
            "operator": "Gt",
            "threshold": "95"
          },
          "actions": [
            { "tagPath": "Simulator/PumpActive", "value": "0" }
          ]
        }
      ],
      "createdAt": "2026-02-06T00:00:00Z",
      "updatedAt": "2026-02-06T00:00:00Z"
    },
    {
      "id": "sm-batch-process",
      "name": "Batch Process Controller",
      "description": "Controls a batch reactor cycle: fill the tank, heat to setpoint, hold temperature, drain, and repeat. Monitors pressure for over-pressure faults and level for overflow/underflow protection. Uses actual simulator tags.",
      "enabled": true,
      "states": [
        {
          "id": "bp-idle",
          "name": "Idle",
          "color": "#6b7280",
          "x": 100,
          "y": 250,
          "isInitial": true,
          "isFinal": false,
          "description": "System is idle, waiting for batch start command",
          "onEnterActions": [
            { "tagPath": "Default Simulator/Status_001", "value": "0" }
          ],
          "onExitActions": []
        },
        {
          "id": "bp-filling",
          "name": "Filling",
          "color": "#3b82f6",
          "x": 300,
          "y": 100,
          "isInitial": false,
          "isFinal": false,
          "description": "Inlet valve open, tank is being filled to 75% level setpoint",
          "onEnterActions": [
            { "tagPath": "Default Simulator/Status_001", "value": "1" }
          ],
          "onExitActions": []
        },
        {
          "id": "bp-heating",
          "name": "Heating",
          "color": "#f59e0b",
          "x": 530,
          "y": 100,
          "isInitial": false,
          "isFinal": false,
          "description": "Heater enabled, raising temperature to 30°C setpoint",
          "onEnterActions": [],
          "onExitActions": [],
          "onEnterScript": "// Log heater activation with current temperature\nvar temp = ReadTagDouble(\"Default Simulator/Temperature_001\");\nLog($\"Heater ON — current temp: {temp:F1}°C, target: 30°C\");"
        },
        {
          "id": "bp-holding",
          "name": "Holding",
          "color": "#22c55e",
          "x": 730,
          "y": 250,
          "isInitial": false,
          "isFinal": false,
          "description": "Maintaining temperature at setpoint for reaction time",
          "onEnterActions": [],
          "onExitActions": [],
          "onEnterScript": "// Record hold start time and monitor temperature drift\nvar temp = ReadTagDouble(\"Default Simulator/Temperature_001\");\nvar pressure = ReadTagDouble(\"Default Simulator/Pressure_001\");\nSetState(\"holdStartUtc\", UtcNow.ToString(\"o\"));\nLog($\"Hold started — T={temp:F1}°C, P={pressure:F2} bar\");",
          "onExitScript": "// Calculate total hold duration\nvar startStr = GetState<string>(\"holdStartUtc\", \"\");\nif (!string.IsNullOrEmpty(startStr))\n{\n    var elapsed = UtcNow - DateTime.Parse(startStr);\n    Log($\"Hold ended after {elapsed.TotalSeconds:F0}s\");\n}"
        },
        {
          "id": "bp-draining",
          "name": "Draining",
          "color": "#8b5cf6",
          "x": 530,
          "y": 400,
          "isInitial": false,
          "isFinal": false,
          "description": "Drain valve open, emptying the tank below 25% level",
          "onEnterActions": [],
          "onExitActions": []
        },
        {
          "id": "bp-complete",
          "name": "Complete",
          "color": "#10b981",
          "x": 300,
          "y": 400,
          "isInitial": false,
          "isFinal": false,
          "description": "Batch cycle finished, ready for next batch or return to Idle",
          "onEnterActions": [
            { "tagPath": "Default Simulator/Status_001", "value": "0" }
          ],
          "onExitActions": []
        },
        {
          "id": "bp-fault",
          "name": "Fault",
          "color": "#ef4444",
          "x": 730,
          "y": 450,
          "isInitial": false,
          "isFinal": true,
          "description": "Over-pressure or abnormal condition detected — requires operator acknowledgment",
          "onEnterActions": [
            { "tagPath": "Default Simulator/Status_001", "value": "0" }
          ],
          "onExitActions": []
        }
      ],
      "transitions": [
        {
          "id": "bp-t1",
          "fromStateId": "bp-idle",
          "toStateId": "bp-filling",
          "event": "batch_start",
          "priority": 0,
          "trigger": {
            "tagPath": "Default Simulator/Status_001",
            "operator": "Eq",
            "threshold": "1"
          },
          "actions": []
        },
        {
          "id": "bp-t2",
          "fromStateId": "bp-filling",
          "toStateId": "bp-heating",
          "event": "tank_full",
          "priority": 0,
          "trigger": {
            "tagPath": "Default Simulator/Level_001",
            "operator": "Gte",
            "threshold": "75"
          },
          "actions": []
        },
        {
          "id": "bp-t3",
          "fromStateId": "bp-heating",
          "toStateId": "bp-holding",
          "event": "temp_reached",
          "priority": 0,
          "trigger": {
            "tagPath": "Default Simulator/Temperature_001",
            "operator": "Gte",
            "threshold": "30"
          },
          "actions": []
        },
        {
          "id": "bp-t4",
          "fromStateId": "bp-holding",
          "toStateId": "bp-draining",
          "event": "hold_complete",
          "priority": 0,
          "trigger": {
            "tagPath": "Default Simulator/Temperature_001",
            "operator": "Lt",
            "threshold": "20"
          },
          "actions": []
        },
        {
          "id": "bp-t5",
          "fromStateId": "bp-draining",
          "toStateId": "bp-complete",
          "event": "tank_empty",
          "priority": 0,
          "trigger": {
            "tagPath": "Default Simulator/Level_001",
            "operator": "Lte",
            "threshold": "25"
          },
          "actions": []
        },
        {
          "id": "bp-t6",
          "fromStateId": "bp-complete",
          "toStateId": "bp-idle",
          "event": "reset",
          "priority": 0,
          "trigger": {
            "tagPath": "Default Simulator/Flow_001",
            "operator": "Lt",
            "threshold": "135"
          },
          "actions": []
        },
        {
          "id": "bp-t7",
          "fromStateId": "bp-filling",
          "toStateId": "bp-fault",
          "event": "overpressure",
          "priority": 1,
          "trigger": {
            "tagPath": "Default Simulator/Pressure_001",
            "operator": "Gt",
            "threshold": "6.5"
          },
          "actions": [
            { "tagPath": "Default Simulator/Status_001", "value": "0" }
          ]
        },
        {
          "id": "bp-t8",
          "fromStateId": "bp-heating",
          "toStateId": "bp-fault",
          "event": "overpressure",
          "priority": 1,
          "trigger": {
            "tagPath": "Default Simulator/Pressure_001",
            "operator": "Gt",
            "threshold": "6.5"
          },
          "actions": [
            { "tagPath": "Default Simulator/Status_001", "value": "0" }
          ]
        },
        {
          "id": "bp-t9",
          "fromStateId": "bp-holding",
          "toStateId": "bp-fault",
          "event": "overpressure",
          "priority": 1,
          "trigger": {
            "tagPath": "Default Simulator/Pressure_001",
            "operator": "Gt",
            "threshold": "6.5"
          },
          "actions": [
            { "tagPath": "Default Simulator/Status_001", "value": "0" }
          ]
        }
      ],
      "createdAt": "2026-02-06T00:00:00Z",
      "updatedAt": "2026-02-06T00:00:00Z"
    }
  ]
}
