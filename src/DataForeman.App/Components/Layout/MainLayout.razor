@inherits LayoutComponentBase
@inject NavigationManager Navigation
@implements IDisposable

<div class="app-container">
    <!-- Minimal Top Menu Bar -->
    <header class="top-header">
        <div class="brand-section">
            <i class="fa-solid fa-gear brand-icon"></i>
            <span class="brand-name">DataForeman</span>
        </div>
        
        <SfMenu TValue="MenuItem" CssClass="top-menu">
            <MenuItems>
                <MenuItem Text="Home" IconCss="fa-solid fa-house" Url="/"></MenuItem>
                <MenuItem Text="Connectivity" IconCss="fa-solid fa-plug" Url="/connectivity"></MenuItem>
                <MenuItem Text="Charts" IconCss="fa-solid fa-chart-line" Url="/charts"></MenuItem>
                <MenuItem Text="Flows" IconCss="fa-solid fa-diagram-project" Url="/flows"></MenuItem>
            </MenuItems>
            <MenuEvents TValue="MenuItem" ItemSelected="OnMenuItemSelected"></MenuEvents>
        </SfMenu>
        
        <div class="header-right">
            <div class="engine-status @(EngineConnected ? "connected" : "disconnected")">
                <i class="fa-solid fa-circle status-dot"></i>
                <span>Engine: @(EngineConnected ? "Online" : "Offline")</span>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="main-content">
        @Body
    </main>
</div>

@code {
    [Inject] private Services.RealtimeDataService? RealtimeData { get; set; }
    
    private bool EngineConnected => RealtimeData?.GetEngineStatus()?.IsRunning ?? false;
    
    protected override void OnInitialized()
    {
        if (RealtimeData != null)
        {
            RealtimeData.OnEngineStatusChanged += HandleStatusChanged;
        }
        Navigation.LocationChanged += OnLocationChanged;
    }
    
    private void HandleStatusChanged()
    {
        InvokeAsync(StateHasChanged);
    }
    
    private void OnLocationChanged(object? sender, LocationChangedEventArgs args)
    {
        StateHasChanged();
    }
    
    private void OnMenuItemSelected(MenuEventArgs<MenuItem> args)
    {
        if (!string.IsNullOrEmpty(args.Item.Url))
        {
            Navigation.NavigateTo(args.Item.Url);
        }
    }
    
    public void Dispose()
    {
        if (RealtimeData != null)
        {
            RealtimeData.OnEngineStatusChanged -= HandleStatusChanged;
        }
        Navigation.LocationChanged -= OnLocationChanged;
    }
}
