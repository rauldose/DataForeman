@inherits LayoutComponentBase
@inject NavigationManager Navigation
@implements IDisposable

<div class="app-container">
    <!-- Top Menu Bar using Syncfusion Menu -->
    <div class="top-header">
        <div class="brand-section">
            <span class="brand-icon">⚙️</span>
            <span class="brand-name">DataForeman</span>
        </div>
        
        <SfMenu TValue="MenuItem" CssClass="top-menu">
            <MenuItems>
                <MenuItem Text="Home" IconCss="e-icons e-home" Url="/"></MenuItem>
                <MenuItem Text="Connectivity" IconCss="e-icons e-link" Url="/connectivity"></MenuItem>
                <MenuItem Text="Charts" IconCss="e-icons e-chart" Url="/charts"></MenuItem>
                <MenuItem Text="Flows" IconCss="e-icons e-flow-chart" Url="/flows"></MenuItem>
            </MenuItems>
            <MenuEvents TValue="MenuItem" ItemSelected="OnMenuItemSelected"></MenuEvents>
        </SfMenu>
        
        <div class="header-right">
            <div class="engine-status">
                <span class="status-indicator @(EngineConnected ? "connected" : "disconnected")"></span>
                <span class="status-text">Engine: @(EngineConnected ? "Connected" : "Disconnected")</span>
            </div>
        </div>
    </div>
    
    <!-- Main Content Area -->
    <main class="main-content">
        @Body
    </main>
</div>

@code {
    [Inject] private Services.RealtimeDataService? RealtimeData { get; set; }
    
    private bool EngineConnected => RealtimeData?.GetEngineStatus()?.IsRunning ?? false;
    
    protected override void OnInitialized()
    {
        if (RealtimeData != null)
        {
            RealtimeData.OnEngineStatusChanged += HandleStatusChanged;
        }
        Navigation.LocationChanged += OnLocationChanged;
    }
    
    private void HandleStatusChanged()
    {
        InvokeAsync(StateHasChanged);
    }
    
    private void OnLocationChanged(object? sender, LocationChangedEventArgs args)
    {
        StateHasChanged();
    }
    
    private void OnMenuItemSelected(MenuEventArgs<MenuItem> args)
    {
        if (!string.IsNullOrEmpty(args.Item.Url))
        {
            Navigation.NavigateTo(args.Item.Url);
        }
    }
    
    public void Dispose()
    {
        if (RealtimeData != null)
        {
            RealtimeData.OnEngineStatusChanged -= HandleStatusChanged;
        }
        Navigation.LocationChanged -= OnLocationChanged;
    }
}
